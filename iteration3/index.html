<!DOCTYPE html>
<html>
    <head>

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    </head>
    
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-route.js"></script>

<body ng-app="myApp">

  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <h1 class="navbar-brand">Plan Your Travel 2</h1>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#/home">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link"  href="#!about">About Us</a>
        </li>
        <li class="nav-item">
          <a class="nav-link"  href="#!contact">Contact Us</a>
        </li>
        <li class="nav-item">
            <a class="nav-link"  href="#!search">Search</a>
          </li>
          <li class="nav-item">
            <a class="nav-link"  href="#!login">Login</a>
          </li>
     </ul>
    </div>
  </nav>
  <div ng-view>
    

  </div>


<script>
var app = angular.module("myApp", ["ngRoute"]);
app.config(function($routeProvider) {
    $routeProvider
    .when("/login",{
      templateUrl: "login.html",
      controller : "loginController"
    })
    .when("/", {
        templateUrl : "home.html",
        controller : "homeController"
    })
    .when("/about", {
        templateUrl : "about.html",
        controller : "aboutController"
    })
    .when("/contact", {
        templateUrl : "contact.html",
        controller : "contactController"
    })
    .when("/search",{
        templateUrl :"search.html",
        controller: "searchController"
    })
    .when('/dashboard',{
      resolve: {
			check: function($location, user) {
				if(!user.isUserLoggedIn()) {
					$location.path('/login');
				}
			},
		},
		    templateUrl: 'dashboard.html',
        controller: 'dashboardController'
    })
    .otherwise({redirectTo:"/home"});
});
app.service('user', function() {
	var username;
	var loggedin = false;
	var id;

	this.setName = function(name) {
		username = name;
	};
	this.getName = function() {
		return username;
	};

	this.setID = function(userID) {
		id = userID;
	};
	this.getID = function() {
		return id;
	};

	this.isUserLoggedIn = function() {
		return loggedin;
	};
	this.userLoggedIn = function() {
		loggedin = true;
	};
});

app.controller("homeController", function ($scope) {
   
});

app.controller("aboutController", function ($scope) {

});
app.controller("contactController", function ($scope) {

});

app.controller("searchController", function ($scope,$http) {
    $http.get("places.php").then(function(response) {
    $scope.myData = response.data.records;
    $scope.image = "images/1.jpg";
    $scope.name= "Eiffel Tower";
    $scope.description = "The Eiffel Tower is a wrought-iron lattice tower on the Champ de Mars in Paris, France. It is named after the engineer Gustave Eiffel, whose company designed and built the tower.";
    $scope.price ="3000.99";
    $scope.onClick = function(obj){
        $scope.name = obj.Name;
        $scope.image = obj.image;
        $scope.description = obj.Description;
        $scope.price = obj.price;
    };

  });
});
app.controller("loginController", function ($scope, $http, $location, user) {
    $scope.login = function(){
      var username = $scope.username;
      var password = $scope.password;
      $http({
        url: "http://localhost/cps630/iteration3/server.php",
        method: 'POST',
        headers:{
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        data: 'username='+username+'&password='+password
      }).then(function(response){
        if(response.data.status == 'loggedadmin'){
          user.userLoggedIn();
          user.setName(response.data.user);
          $location.path('/dashboard');
        }
        else{
          alert('invalid');
        }
      })
    }
});
app.controller("dashboardController",function($scope, user){
  $scope.user = user.getName();
});
app.config(['$httpProvider', function($httpProvider) {
    if (!$httpProvider.defaults.headers.get) {
        $httpProvider.defaults.headers.get = {};    
    }    
    $httpProvider.defaults.headers.get['If-Modified-Since'] = 'Mon, 26 Jul 1997 05:00:00 GMT';
    $httpProvider.defaults.headers.get['Cache-Control'] = 'no-cache';
    $httpProvider.defaults.headers.get['Pragma'] = 'no-cache';
}]);


</script>

</body>
</html>